# Basics
Options -Indexes
ServerSignature Off

# Protect Sensitive Files
<FilesMatch "^(secrets|supabase_helper|constants)\.php$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Protect Dot Files (.git, .env, etc) and Markdown/SQL
<FilesMatch "^\.|^.*\.(md|sql)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Security Headers
<IfModule mod_headers.c>
    Header set X-XSS-Protection "1; mode=block"
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    # Header set Content-Security-Policy "default-src 'self' https:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:;"
</IfModule>

# Force HTTPS (Uncomment to enable on production)
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>

# URL Rewriting (Clean URLs)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # 1. Redirect external .php requests to clean URL (e.g. /about.php -> /about)
    RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
    RewriteRule ^ %1 [R=301,L]

    # 2. Skip if request maps to existing directory
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 3. Internally map clean URL to .php file (e.g. /about -> /about.php)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.php -f
    RewriteRule ^(.*)$ $1.php [L]

    # 4. Custom Friendly Routes
    # /vagas/123 -> /trabalhe-conosco/vaga.php?id=123
    RewriteRule ^vagas/([a-zA-Z0-9-]+)/?$ trabalhe-conosco/vaga.php?id=$1 [L,QSA]
</IfModule>
